; Music Test
; To make sounds write to 8-bit latch with
; 	Most Significant bit is enable sound
; 	Bottom 7 bits are piano key

secsCount:	.long 0x0

;
; Test code
;
00000000	429000D8		lix		r9,216			; 8-bit notes (0-87)
00000001	42800080		lix		r8,0x80			; first note is 0
;	bsr	enableBuzzer
nextNote:
00000002	A0408000		push	r8				; save the counter
00000003	428000FA		lix		r8,250			; count for 10 mSec
00000004	D4000011		bsr		delay_mS		; call delay_ms
00000005	A1804000		pull	r8				; restore r8
00000006	D4000008		bsr		wr7Seg8Dig
00000007	D400001B		bsr 	setNote
00000008	20881000		add		r8,r8,ONE
00000009	30389000		cmp		r8,r9
0000000a	D2FFFFF8		bne		nextNote
0000000b	42800000		lix		r8,0x0
0000000c	D4000016		bsr 	setNote
loopForever:
0000000d	C0000000		bra		loopForever
	
; wr7Seg8Dig
; passed r8 - value to send to the 7 seg display

wr7Seg8Dig:
0000000e	A0405000		push	PAR
0000000f	A0408000		push	r8
00000010	42503000		lix		PAR,0x3000		; Seven Segment LED lines
00000011	85508000		spl		r8				; Write out LED bits
00000012	A1804000		pull	r8
00000013	A1504000		pull	PAR
00000014	A1704000		pull	PC

; delay_mS - delay for the number of mSecs passed in r8
; pass mSec delay in r8
; Routine uses r9

delay_mS:
00000015	A0408000		push	r8
00000016	A0409000		push	r9
00000017	A0405000		push	PAR
00000018	42503802		lix		PAR,0x3802		; address of the mSec counter
00000019	84905000		lpl		r9				; read the peripheral counter into r9
0000001a	20898000		add		r8,r9,r8		; terminal counter to wait until is in r8
loop_delay_mS:
0000001b	84905000		lpl		r9				; check the elapsed time counter
0000001c	30389000		cmp		r8,r9
0000001d	CCFFFFFE		blt		loop_delay_mS
0000001e	A1504000		pull	PAR
0000001f	A1904000		pull	r9
00000020	A1804000		pull	r8
00000021	A1704000		pull	PC

;
; setNote - Set the note
; pass note in r8
;

setNote:
00000022	A0408000		push	r8
00000023	A0405000		push	PAR
00000024	42504000		lix		PAR,0x4000
00000025	85508000		spl		r8
00000026	A1504000		pull	PAR
00000027	A1804000		pull	r8
00000028	A1704000		pull	PC
